---
# k3s still recommended use legacy iptables
# https://rancher.com/docs/k3s/latest/en/known-issues/
- name: network | configure nodes to use legacy iptables
  community.general.alternatives:
    name: "{{ item }}"
    path: /usr/sbin/{{ item }}-legacy
  loop:
    - "iptables"
    - "ip6tables"

- name: network | sysctl ip forward
  copy:
    dest: /etc/sysctl.d/99-kubernetes-cri.conf
    content: |
      net.ipv4.ip_forward = 1
  notify: sysctl configuration changed

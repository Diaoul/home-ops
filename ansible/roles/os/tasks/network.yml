---
# k3s recommendes to use legacy iptables
# https://rancher.com/docs/k3s/latest/en/known-issues/
- name: network | configure nodes to use legacy iptables
  community.general.alternatives:
    name: "{{ item }}"
    path: /usr/sbin/{{ item }}-legacy
  loop:
    - iptables
    - ip6tables
  when: '"master" in group_names or "worker" in group_names'

- name: network | sysctl ip forward
  ansible.posix.sysctl:
    name: net.ipv4.ip_forward
    value: "1"
    sysctl_file: /etc/sysctl.d/99-kubernetes-cri.conf
  when: '"master" in group_names or "worker" in group_names'

---
- name: filesystem | sysctl update max_user_watches
  ansible.posix.sysctl:
    name: fs.inotify.max_user_watches
    value: "524288"
    sysctl_file: /etc/sysctl.d/98-kubernetes-fs.conf
  when: '"master" in group_names or "worker" in group_names'

- name: filesystem | mount bpffs
  ansible.posix.mount:
    src: bpffs
    path: /sys/fs/bpf
    fstype: bpf
    state: mounted
    opts: rw,nosuid,nodev,noexec,relatime,mode=700
  when: '"master" in group_names or "worker" in group_names'

- name: filesystem | swap
  block:
    - name: filesystem | disable swap
      command: swapoff -a
      when: ansible_swaptotal_mb > 0
    - name: filesystem | disable swap system start
      ansible.posix.mount:
        name: "{{ item }}"
        fstype: swap
        state: absent
      loop:
        - swap
        - none

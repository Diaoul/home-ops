---
- name: install package
  ansible.builtin.apt:
    name: ufw
  become: true

- name: reset configuration
  ufw:
    state: reset
  become: true
  when: ufw_reset

- name: set logging
  ufw:
    logging: "on"
  become: true

- name: allow ssh
  ufw:
    rule: allow
    port: ssh
  become: true

- name: allow ports
  ufw:
    rule: allow
    port: "{{ item.port }}"
    proto: "{{ item.proto }}"
  loop: "{{ ufw_allow }}"
  become: true
  when: ufw_allow is defined and ufw_allow|length

- name: deny incoming traffic
  ufw:
    policy: deny
    direction: incoming
  become: true

- name: enable
  ufw:
    state: enabled
  become: true

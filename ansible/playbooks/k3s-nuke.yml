---
- hosts:
    - server
    - agent
  vars_prompt:
    name: "run_confirmation"
    prompt: "This will DESTROY your cluster. Do you wish to continue? [y/N]"
    default: "N"
    private: no
  vars:
    k3s_state: uninstalled
  any_errors_fatal: yes

  pre_tasks:
    - name: cluster-nuke | check confirmation
      fail:
        msg: "Abort."
      when: run_confirmation | lower != "y"

  roles:
    - xanmanning.k3s

  tasks:
    - name: cluster-nuke | reboot
      reboot:
        msg: "Nodes are being rebooted..."
      ignore_errors: yes
